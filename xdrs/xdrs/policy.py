"""
主要用于通过解析配置文件/etc/xdrs/policy.json而确定用户是否有执行某一action的权限；
"""

import os.path
from oslo.config import cfg

from xdrs import exception
from xdrs.openstack.common import policy
from xdrs import utils


CONF = cfg.CONF
CONF.import_opt('policy_file', 'xdrs.service')
CONF.import_opt('policy_default_rule', 'xdrs.service')


_POLICY_PATH = None
_POLICY_CACHE = {}


def reset():
    global _POLICY_PATH
    global _POLICY_CACHE
    _POLICY_PATH = None
    _POLICY_CACHE = {}
    policy.reset()


def init():
    global _POLICY_PATH
    global _POLICY_CACHE
    if not _POLICY_PATH:
        _POLICY_PATH = CONF.policy_file
        if not os.path.exists(_POLICY_PATH):
            _POLICY_PATH = CONF.find_file(_POLICY_PATH)
        if not _POLICY_PATH:
            raise exception.ConfigNotFound(path=CONF.policy_file)
    
    """
    ======================================================================================
    _POLICY_PATH = /etc/xdrs/policy.json
    _POLICY_CACHE = {'data': '{\n    "context_is_admin":  "role:admin",\n    "admin_or_owner":  "is_admin:True or project_id:%(project_id)s",\n    "default": "rule:admin_or_owner",\n\n    "cells_scheduler_filter:TargetCellFilter": "is_admin:True",\n\n    "compute:create": "",\n    "compute:create:attach_network": "",\n    "compute:create:attach_volume": "",\n    "compute:create:forced_host": "is_admin:True",\n    "compute:get_all": "",\n    "compute:get_all_tenants": "",\n    "compute:start": "rule:admin_or_owner",\n    "compute:stop": "rule:admin_or_owner",\n    "compute:unlock_override": "rule:admin_api",\n\n    "compute:shelve": "",\n    "compute:shelve_offload": "",\n    "compute:unshelve": "",\n\n    "compute:volume_snapshot_create": "",\n    "compute:volume_snapshot_delete": "",\n\n    "admin_api": "is_admin:True",\n    "compute:v3:servers:start": "rule:admin_or_owner",\n    "compute:v3:servers:stop": "rule:admin_or_owner",\n    "compute_extension:v3:os-access-ips:discoverable": "",\n    "compute_extension:v3:os-access-ips": "",\n    "compute_extension:accounts": "rule:admin_api",\n    "compute_extension:admin_actions": "rule:admin_api",\n    "compute_extension:admin_actions:pause": "rule:admin_or_owner",\n    "compute_extension:admin_actions:unpause": "rule:admin_or_owner",\n    "compute_extension:admin_actions:suspend": "rule:admin_or_owner",\n    "compute_extension:admin_actions:resume": "rule:admin_or_owner",\n    "compute_extension:admin_actions:lock": "rule:admin_or_owner",\n    "compute_extension:admin_actions:unlock": "rule:admin_or_owner",\n    "compute_extension:admin_actions:resetNetwork": "rule:admin_api",\n    "compute_extension:admin_actions:injectNetworkInfo": "rule:admin_api",\n    "compute_extension:admin_actions:createBackup": "rule:admin_or_owner",\n    "compute_extension:admin_actions:migrateLive": "rule:admin_api",\n    "compute_extension:admin_actions:resetState": "rule:admin_api",\n    "compute_extension:admin_actions:migrate": "rule:admin_api",\n    "compute_extension:v3:os-admin-actions": "rule:admin_api",\n    "compute_extension:v3:os-admin-actions:discoverable": "",\n    "compute_extension:v3:os-admin-actions:reset_network": "rule:admin_api",\n    "compute_extension:v3:os-admin-actions:inject_network_info": "rule:admin_api",\n    "compute_extension:v3:os-admin-actions:reset_state": "rule:admin_api",\n    "compute_extension:v3:os-admin-password": "",\n    "compute_extension:v3:os-admin-password:discoverable": "",\n    "compute_extension:aggregates": "rule:admin_api",\n    "compute_extension:v3:os-aggregates:discoverable": "",\n    "compute_extension:v3:os-aggregates:index": "rule:admin_api",\n    "compute_extension:v3:os-aggregates:create": "rule:admin_api",\n    "compute_extension:v3:os-aggregates:show": "rule:admin_api",\n    "compute_extension:v3:os-aggregates:update": "rule:admin_api",\n    "compute_extension:v3:os-aggregates:delete": "rule:admin_api",\n    "compute_extension:v3:os-aggregates:add_host": "rule:admin_api",\n    "compute_extension:v3:os-aggregates:remove_host": "rule:admin_api",\n    "compute_extension:v3:os-aggregates:set_metadata": "rule:admin_api",\n    "compute_extension:agents": "rule:admin_api",\n    "compute_extension:v3:os-agents": "rule:admin_api",\n    "compute_extension:v3:os-agents:discoverable": "",\n    "compute_extension:attach_interfaces": "",\n    "compute_extension:v3:os-attach-interfaces": "",\n    "compute_extension:v3:os-attach-interfaces:discoverable": "",\n    "compute_extension:baremetal_nodes": "rule:admin_api",\n    "compute_extension:cells": "rule:admin_api",\n    "compute_extension:v3:os-cells": "rule:admin_api",\n    "compute_extension:v3:os-cells:discoverable": "",\n    "compute_extension:certificates": "",\n    "compute_extension:v3:os-certificates:create": "",\n    "compute_extension:v3:os-certificates:show": "",\n    "compute_extension:v3:os-certificates:discoverable": "",\n    "compute_extension:cloudpipe": "rule:admin_api",\n    "compute_extension:cloudpipe_update": "rule:admin_api",\n    "compute_extension:console_output": "",\n    "compute_extension:v3:consoles:discoverable": "",\n    "compute_extension:v3:os-console-output:discoverable": "",\n    "compute_extension:v3:os-console-output": "",\n    "compute_extension:consoles": "",\n    "compute_extension:v3:os-remote-consoles": "",\n    "compute_extension:v3:os-remote-consoles:discoverable": "",\n    "compute_extension:createserverext": "",\n    "compute_extension:v3:os-create-backup:discoverable": "",\n    "compute_extension:v3:os-create-backup": "rule:admin_or_owner",\n    "compute_extension:deferred_delete": "",\n    "compute_extension:v3:os-deferred-delete": "",\n    "compute_extension:v3:os-deferred-delete:discoverable": "",\n    "compute_extension:disk_config": "",\n    "compute_extension:evacuate": "rule:admin_api",\n    "compute_extension:v3:os-evacuate": "rule:admin_api",\n    "compute_extension:v3:os-evacuate:discoverable": "",\n    "compute_extension:extended_server_attributes": "rule:admin_api",\n    "compute_extension:v3:os-extended-server-attributes": "rule:admin_api",\n    "compute_extension:v3:os-extended-server-attributes:discoverable": "",\n    "compute_extension:extended_status": "",\n    "compute_extension:v3:os-extended-status": "",\n    "compute_extension:v3:os-extended-status:discoverable": "",\n    "compute_extension:extended_availability_zone": "",\n    "compute_extension:v3:os-extended-availability-zone": "",\n    "compute_extension:v3:os-extended-availability-zone:discoverable": "",\n    "compute_extension:extended_ips": "",\n    "compute_extension:extended_ips_mac": "",\n    "compute_extension:extended_vif_net": "",\n    "compute_extension:v3:extension_info:discoverable": "",\n    "compute_extension:extended_volumes": "",\n    "compute_extension:v3:os-extended-volumes": "",\n    "compute_extension:v3:os-extended-volumes:swap": "",\n    "compute_extension:v3:os-extended-volumes:discoverable": "",\n    "compute_extension:v3:os-extended-volumes:attach": "",\n    "compute_extension:v3:os-extended-volumes:detach": "",\n    "compute_extension:fixed_ips": "rule:admin_api",\n    "compute_extension:flavor_access": "",\n    "compute_extension:flavor_access:addTenantAccess": "rule:admin_api",\n    "compute_extension:flavor_access:removeTenantAccess": "rule:admin_api",\n    "compute_extension:v3:flavor-access": "",\n    "compute_extension:v3:flavor-access:discoverable": "",\n    "compute_extension:v3:flavor-access:remove_tenant_access": "rule:admin_api",\n    "compute_extension:v3:flavor-access:add_tenant_access": "rule:admin_api",\n    "compute_extension:flavor_disabled": "",\n    "compute_extension:flavor_rxtx": "",\n    "compute_extension:v3:os-flavor-rxtx": "",\n    "compute_extension:v3:os-flavor-rxtx:discoverable": "",\n    "compute_extension:flavor_swap": "",\n    "compute_extension:flavorextradata": "",\n    "compute_extension:flavorextraspecs:index": "",\n    "compute_extension:flavorextraspecs:show": "",\n    "compute_extension:flavorextraspecs:create": "rule:admin_api",\n    "compute_extension:flavorextraspecs:update": "rule:admin_api",\n    "compute_extension:flavorextraspecs:delete": "rule:admin_api",\n    "compute_extension:v3:flavors:discoverable": "",\n    "compute_extension:v3:flavor-extra-specs:discoverable": "",\n    "compute_extension:v3:flavor-extra-specs:index": "",\n    "compute_extension:v3:flavor-extra-specs:show": "",\n    "compute_extension:v3:flavor-extra-specs:create": "rule:admin_api",\n    "compute_extension:v3:flavor-extra-specs:update": "rule:admin_api",\n    "compute_extension:v3:flavor-extra-specs:delete": "rule:admin_api",\n    "compute_extension:flavormanage": "rule:admin_api",\n    "compute_extension:v3:flavor-manage": "rule:admin_api",\n    "compute_extension:floating_ip_dns": "",\n    "compute_extension:floating_ip_pools": "",\n    "compute_extension:floating_ips": "",\n    "compute_extension:floating_ips_bulk": "rule:admin_api",\n    "compute_extension:fping": "",\n    "compute_extension:fping:all_tenants": "rule:admin_api",\n    "compute_extension:hide_server_addresses": "is_admin:False",\n    "compute_extension:v3:os-hide-server-addresses": "is_admin:False",\n    "compute_extension:v3:os-hide-server-addresses:discoverable": "",\n    "compute_extension:hosts": "rule:admin_api",\n    "compute_extension:v3:os-hosts": "rule:admin_api",\n    "compute_extension:v3:os-hosts:discoverable": "",\n    "compute_extension:hypervisors": "rule:admin_api",\n    "compute_extension:v3:os-hypervisors": "rule:admin_api",\n    "compute_extension:v3:os-hypervisors:discoverable": "",\n    "compute_extension:image_size": "",\n    "compute_extension:instance_actions": "",\n    "compute_extension:v3:os-instance-actions": "",\n    "compute_extension:v3:os-instance-actions:discoverable": "",\n    "compute_extension:instance_actions:events": "rule:admin_api",\n    "compute_extension:v3:os-instance-actions:events": "rule:admin_api",\n    "compute_extension:instance_usage_audit_log": "rule:admin_api",\n    "compute_extension:v3:ips:discoverable": "",\n    "compute_extension:keypairs": "",\n    "compute_extension:keypairs:index": "",\n    "compute_extension:keypairs:show": "",\n    "compute_extension:keypairs:create": "",\n    "compute_extension:keypairs:delete": "",\n    "compute_extension:v3:keypairs:discoverable": "",\n    "compute_extension:v3:keypairs": "",\n    "compute_extension:v3:keypairs:index": "",\n    "compute_extension:v3:keypairs:show": "",\n    "compute_extension:v3:keypairs:create": "",\n    "compute_extension:v3:keypairs:delete": "",\n    "compute_extension:v3:os-lock-server:discoverable": "",\n    "compute_extension:v3:os-lock-server:lock": "rule:admin_or_owner",\n    "compute_extension:v3:os-lock-server:unlock": "rule:admin_or_owner",\n    "compute_extension:v3:os-migrate-server:discoverable": "",\n    "compute_extension:v3:os-migrate-server:migrate": "rule:admin_api",\n    "compute_extension:v3:os-migrate-server:migrate_live": "rule:admin_api",\n    "compute_extension:multinic": "",\n    "compute_extension:v3:os-multinic": "",\n    "compute_extension:v3:os-multinic:discoverable": "",\n    "compute_extension:networks": "rule:admin_api",\n    "compute_extension:networks:view": "",\n    "compute_extension:networks_associate": "rule:admin_api",\n    "compute_extension:v3:os-pause-server:discoverable": "",\n    "compute_extension:v3:os-pause-server:pause": "rule:admin_or_owner",\n    "compute_extension:v3:os-pause-server:unpause": "rule:admin_or_owner",\n    "compute_extension:v3:os-pci:pci_servers": "",\n    "compute_extension:v3:os-pci:discoverable": "",\n    "compute_extension:v3:os-pci:index": "rule:admin_api",\n    "compute_extension:v3:os-pci:detail": "rule:admin_api",\n    "compute_extension:v3:os-pci:show": "rule:admin_api",\n    "compute_extension:quotas:show": "",\n    "compute_extension:quotas:update": "rule:admin_api",\n    "compute_extension:quotas:delete": "rule:admin_api",\n    "compute_extension:v3:os-quota-sets:discoverable": "",\n    "compute_extension:v3:os-quota-sets:show": "",\n    "compute_extension:v3:os-quota-sets:update": "rule:admin_api",\n    "compute_extension:v3:os-quota-sets:delete": "rule:admin_api",\n    "compute_extension:v3:os-quota-sets:detail": "rule:admin_api",\n    "compute_extension:quota_classes": "",\n    "compute_extension:rescue": "",\n    "compute_extension:v3:os-rescue": "",\n    "compute_extension:v3:os-rescue:discoverable": "",\n    "compute_extension:v3:os-scheduler-hints:discoverable": "",\n    "compute_extension:security_group_default_rules": "rule:admin_api",\n    "compute_extension:security_groups": "",\n    "compute_extension:v3:os-security-groups": "",\n    "compute_extension:v3:os-security-groups:discoverable": "",\n    "compute_extension:server_diagnostics": "rule:admin_api",\n    "compute_extension:v3:os-server-diagnostics": "rule:admin_api",\n    "compute_extension:v3:os-server-diagnostics:discoverable": "",\n    "compute_extension:server_groups": "",\n    "compute_extension:server_password": "",\n    "compute_extension:v3:os-server-password": "",\n    "compute_extension:v3:os-server-password:discoverable": "",\n    "compute_extension:server_usage": "",\n    "compute_extension:v3:os-server-usage": "",\n    "compute_extension:v3:os-server-usage:discoverable": "",\n    "compute_extension:services": "rule:admin_api",\n    "compute_extension:v3:os-services": "rule:admin_api",\n    "compute_extension:v3:os-services:discoverable": "",\n    "compute_extension:v3:server-metadata:discoverable": "",\n    "compute_extension:v3:servers:discoverable": "",\n    "compute_extension:shelve": "",\n    "compute_extension:shelveOffload": "rule:admin_api",\n    "compute_extension:v3:os-shelve:shelve": "",\n    "compute_extension:v3:os-shelve:shelve:discoverable": "",\n    "compute_extension:v3:os-shelve:shelve_offload": "rule:admin_api",\n    "compute_extension:simple_tenant_usage:show": "rule:admin_or_owner",\n    "compute_extension:v3:os-suspend-server:discoverable": "",\n    "compute_extension:v3:os-suspend-server:suspend": "rule:admin_or_owner",\n    "compute_extension:v3:os-suspend-server:resume": "rule:admin_or_owner",\n    "compute_extension:simple_tenant_usage:list": "rule:admin_api",\n    "compute_extension:unshelve": "",\n    "compute_extension:v3:os-shelve:unshelve": "",\n    "compute_extension:users": "rule:admin_api",\n    "compute_extension:v3:os-user-data:discoverable": "",\n    "compute_extension:virtual_interfaces": "",\n    "compute_extension:virtual_storage_arrays": "",\n    "compute_extension:volumes": "",\n    "compute_extension:volume_attachments:index": "",\n    "compute_extension:volume_attachments:show": "",\n    "compute_extension:volume_attachments:create": "",\n    "compute_extension:volume_attachments:update": "",\n    "compute_extension:volume_attachments:delete": "",\n    "compute_extension:volumetypes": "",\n    "compute_extension:availability_zone:list": "",\n    "compute_extension:v3:os-availability-zone:list": "",\n    "compute_extension:v3:os-availability-zone:discoverable": "",\n    "compute_extension:availability_zone:detail": "rule:admin_api",\n    "compute_extension:v3:os-availability-zone:detail": "rule:admin_api",\n    "compute_extension:used_limits_for_admin": "rule:admin_api",\n    "compute_extension:migrations:index": "rule:admin_api",\n    "compute_extension:v3:os-migrations:index": "rule:admin_api",\n    "compute_extension:v3:os-migrations:discoverable": "",\n    "compute_extension:os-assisted-volume-snapshots:create": "rule:admin_api",\n    "compute_extension:os-assisted-volume-snapshots:delete": "rule:admin_api",\n    "compute_extension:console_auth_tokens": "rule:admin_api",\n    "compute_extension:v3:os-console-auth-tokens": "rule:admin_api",\n    "compute_extension:os-server-external-events:create": "rule:admin_api",\n    "compute_extension:v3:os-server-external-events:create": "rule:admin_api",\n\n    "volume:create": "",\n    "volume:get_all": "",\n    "volume:get_volume_metadata": "",\n    "volume:get_snapshot": "",\n    "volume:get_all_snapshots": "",\n\n\n    "volume_extension:types_manage": "rule:admin_api",\n    "volume_extension:types_extra_specs": "rule:admin_api",\n    "volume_extension:volume_admin_actions:reset_status": "rule:admin_api",\n    "volume_extension:snapshot_admin_actions:reset_status": "rule:admin_api",\n    "volume_extension:volume_admin_actions:force_delete": "rule:admin_api",\n\n\n    "network:get_all": "",\n    "network:get": "",\n    "network:create": "",\n    "network:delete": "",\n    "network:associate": "",\n    "network:disassociate": "",\n    "network:get_vifs_by_instance": "",\n    "network:allocate_for_instance": "",\n    "network:deallocate_for_instance": "",\n    "network:validate_networks": "",\n    "network:get_instance_uuids_by_ip_filter": "",\n    "network:get_instance_id_by_floating_address": "",\n    "network:setup_networks_on_host": "",\n    "network:get_backdoor_port": "",\n\n    "network:get_floating_ip": "",\n    "network:get_floating_ip_pools": "",\n    "network:get_floating_ip_by_address": "",\n    "network:get_floating_ips_by_project": "",\n    "network:get_floating_ips_by_fixed_address": "",\n    "network:allocate_floating_ip": "",\n    "network:deallocate_floating_ip": "",\n    "network:associate_floating_ip": "",\n    "network:disassociate_floating_ip": "",\n    "network:release_floating_ip": "",\n    "network:migrate_instance_start": "",\n    "network:migrate_instance_finish": "",\n\n    "network:get_fixed_ip": "",\n    "network:get_fixed_ip_by_address": "",\n    "network:add_fixed_ip_to_instance": "",\n    "network:remove_fixed_ip_from_instance": "",\n    "network:add_network_to_project": "",\n    "network:get_instance_nw_info": "",\n\n    "network:get_dns_domains": "",\n    "network:add_dns_entry": "",\n    "network:modify_dns_entry": "",\n    "network:delete_dns_entry": "",\n    "network:get_dns_entries_by_address": "",\n    "network:get_dns_entries_by_name": "",\n    "network:create_private_dns_domain": "",\n    "network:create_public_dns_domain": "",\n    "network:delete_dns_domain": ""\n}\n', 'mtime': 1412292720.0}
    reload_func = <function _set_rules at 0x27ac9b0>
    ======================================================================================
    """
    utils.read_cached_file(_POLICY_PATH, _POLICY_CACHE,
                           reload_func=_set_rules)


def _set_rules(data):
    default_rule = CONF.policy_default_rule
    policy.set_rules(policy.Rules.load_json(data, default_rule))


def enforce(context, action, target, do_raise=True):
    """
    Verifies that the action is valid on the target in this context.
    """
    """
    ======================================================================================
    context = <xdrs.context.RequestContext object at 0x6dcf050>
    target = {'project_id': u'4537aca4a4a4462fa4c59ad5b5581f00', 'user_id': u'91d732b65831491d8bd952b3111e62dd'}
    action = xdrs:get_algorithms
    ======================================================================================
    """
    init()
    
    credentials = context.to_dict()
    """
    ======================================================================================
    credentials = {'project_name': u'admin', 'user_id': u'91d732b65831491d8bd952b3111e62dd', 'roles': [u'heat_stack_owner', u'_member_', u'admin'], 'timestamp': '2015-03-10T06:48:40.110653', 'auth_token': 'MIIT9wYJKoZIhvcNAQcCoIIT6DCCE+QCAQExCTAHBgUrDgMCGjCCEk0GCSqGSIb3DQEHAaCCEj4EghI6eyJhY2Nlc3MiOiB7InRva2VuIjogeyJpc3N1ZWRfYXQiOiAiMjAxNS0wMy0xMFQwNjo0ODozOS41MzU2NjEiLCAiZXhwaXJlcyI6ICIyMDE1LTAzLTEwVDA3OjQ4OjM5WiIsICJpZCI6ICJwbGFjZWhvbGRlciIsICJ0ZW5hbnQiOiB7ImRlc2NyaXB0aW9uIjogImFkbWluIHRlbmFudCIsICJlbmFibGVkIjogdHJ1ZSwgImlkIjogIjQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgIm5hbWUiOiAiYWRtaW4ifX0sICJzZXJ2aWNlQ2F0YWxvZyI6IFt7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc0L3YyLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzQvdjIvNDUzN2FjYTRhNGE0NDYyZmE0YzU5YWQ1YjU1ODFmMDAiLCAiaWQiOiAiMTZiMTVjYzVmZjUwNGNiODlmNTg2NjRlMjdhNjljNjkiLCAicHVibGljVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc0L3YyLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogImNvbXB1dGUiLCAibmFtZSI6ICJub3ZhIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjk2OTYvIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjk2OTYvIiwgImlkIjogIjFiMjkzYTgxNjk2YjRiN2Y4OTZlYWQ0NjIyYTFjMmExIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6OTY5Ni8ifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAibmV0d29yayIsICJuYW1lIjogIm5ldXRyb24ifSwgeyJlbmRwb2ludHMiOiBbeyJhZG1pblVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODc3Ni92Mi80NTM3YWNhNGE0YTQ0NjJmYTRjNTlhZDViNTU4MWYwMCIsICJyZWdpb24iOiAiUmVnaW9uT25lIiwgImludGVybmFsVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc2L3YyLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgImlkIjogIjNhNzY3OWNjZTdkZjRhY2ZhMTZiM2NhNTJkZGNmYzgyIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODc3Ni92Mi80NTM3YWNhNGE0YTQ0NjJmYTRjNTlhZDViNTU4MWYwMCJ9XSwgImVuZHBvaW50c19saW5rcyI6IFtdLCAidHlwZSI6ICJ2b2x1bWV2MiIsICJuYW1lIjogImNpbmRlcnYyIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzQvdjMiLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODc3NC92MyIsICJpZCI6ICIwYmIxZDFiODhhZmU0MGRhOTNiY2IxNTg0Y2ExN2ZiOSIsICJwdWJsaWNVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzQvdjMifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAiY29tcHV0ZXYzIiwgIm5hbWUiOiAibm92YXYzIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwODAiLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODA4MCIsICJpZCI6ICIxZTMyZTE3MmU3OWM0YzVhYTZiNWM3ZjhkNzVhZjRmYiIsICJwdWJsaWNVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwODAifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAiczMiLCAibmFtZSI6ICJzd2lmdF9zMyJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo5MjkyIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjkyOTIiLCAiaWQiOiAiM2QxYzc5MjY1MWEwNDljNWE2MWUzNWJmZWZjNGM4OGIiLCAicHVibGljVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo5MjkyIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogImltYWdlIiwgIm5hbWUiOiAiZ2xhbmNlIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzciLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODc3NyIsICJpZCI6ICIzOWE0YzA2NDIzYTg0OTNjOTI4ZGExOGY0YTVjY2MxZiIsICJwdWJsaWNVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzcifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAibWV0ZXJpbmciLCAibmFtZSI6ICJjZWlsb21ldGVyIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwMDAvdjEvIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwMDAvdjEvIiwgImlkIjogIjU1NzBiOGY4MTE0OTRlMWI5NTVkYjZlNTAzZGYyYWZkIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODAwMC92MS8ifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAiY2xvdWRmb3JtYXRpb24iLCAibmFtZSI6ICJoZWF0LWNmbiJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc2L3YxLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzYvdjEvNDUzN2FjYTRhNGE0NDYyZmE0YzU5YWQ1YjU1ODFmMDAiLCAiaWQiOiAiMGExYzhkYTRmMTU2NDk1YWFkMjEzMGUyYzA2OTE5ODIiLCAicHVibGljVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc2L3YxLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogInZvbHVtZSIsICJuYW1lIjogImNpbmRlciJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4NzczL3NlcnZpY2VzL0FkbWluIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzMvc2VydmljZXMvQ2xvdWQiLCAiaWQiOiAiMDMzZjY3ZTk1MDBjNDljYThmOGIxODkzZTJhN2VkYWYiLCAicHVibGljVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4NzczL3NlcnZpY2VzL0Nsb3VkIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogImVjMiIsICJuYW1lIjogIm5vdmFfZWMyIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwMDQvdjEvNDUzN2FjYTRhNGE0NDYyZmE0YzU5YWQ1YjU1ODFmMDAiLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODAwNC92MS80NTM3YWNhNGE0YTQ0NjJmYTRjNTlhZDViNTU4MWYwMCIsICJpZCI6ICI0YmViNjQ0MjUzYWU0NzdmOWU5NDk2ZWVkZDEwOTNhNSIsICJwdWJsaWNVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwMDQvdjEvNDUzN2FjYTRhNGE0NDYyZmE0YzU5YWQ1YjU1ODFmMDAifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAib3JjaGVzdHJhdGlvbiIsICJuYW1lIjogImhlYXQifSwgeyJlbmRwb2ludHMiOiBbeyJhZG1pblVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODA4MC8iLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODA4MC92MS9BVVRIXzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgImlkIjogIjNhMTA2MzU0MjYxMDQzMjk5YTVkMjQ3ZTVmMjU5NGQyIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODA4MC92MS9BVVRIXzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogIm9iamVjdC1zdG9yZSIsICJuYW1lIjogInN3aWZ0In0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjM1MzU3L3YyLjAiLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6NTAwMC92Mi4wIiwgImlkIjogIjVjNGVlN2MzMTE4NDQyNGM5NDJhMWM1MjgxODU3MmZiIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6NTAwMC92Mi4wIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogImlkZW50aXR5IiwgIm5hbWUiOiAia2V5c3RvbmUifV0sICJ1c2VyIjogeyJ1c2VybmFtZSI6ICJhZG1pbiIsICJyb2xlc19saW5rcyI6IFtdLCAiaWQiOiAiOTFkNzMyYjY1ODMxNDkxZDhiZDk1MmIzMTExZTYyZGQiLCAicm9sZXMiOiBbeyJuYW1lIjogImhlYXRfc3RhY2tfb3duZXIifSwgeyJuYW1lIjogIl9tZW1iZXJfIn0sIHsibmFtZSI6ICJhZG1pbiJ9XSwgIm5hbWUiOiAiYWRtaW4ifSwgIm1ldGFkYXRhIjogeyJpc19hZG1pbiI6IDAsICJyb2xlcyI6IFsiZDlmZGVlODI1NjE3NGJlNWE3MmFjZGZmNDNkM2VkZDMiLCAiOWZlMmZmOWVlNDM4NGIxODk0YTkwODc4ZDNlOTJiYWIiLCAiN2E1ZTg5MmFiYTE5NDI3NWI3ZjQxZWM4Njg2ZDUwOGYiXX19fTGCAYEwggF9AgEBMFwwVzELMAkGA1UEBhMCVVMxDjAMBgNVBAgMBVVuc2V0MQ4wDAYDVQQHDAVVbnNldDEOMAwGA1UECgwFVW5zZXQxGDAWBgNVBAMMD3d3dy5leGFtcGxlLmNvbQIBATAHBgUrDgMCGjANBgkqhkiG9w0BAQEFAASCAQBkwVlwVgYM+mCIXICViGPgW+AZ--Y3NfWjW92GTBqW4keVrPosYxz--b2SVSGqwOHI1xFPqIx1+fzBCcilE5rIuJ3gxAc2VEWl4whMkriqWo6M8YY+GxGJ07h1NZ3Jc9Mrk7RTWPwU9YPilWPSU9sRx4bv+y7XpL8EIEvi+0dvHKgGI+nvqEYVFIf1vYQN5bvSnAgC1rZ9oB0M4Pg1wd47xQcenZL+XOWb8uxUReAvT-lfjXav7DhwUzPgmlY2XpN+9yfhAXAFF0GkokwjncvC5YTILOa41eMUg8ip47+rijNpQ2FuxVpRhQ-xL9it8+vAYkGLqe7eaQylsf0Nu6JJ', 'remote_address': '172.21.7.40', 'quota_class': None, 'is_admin': True, 'tenant': u'4537aca4a4a4462fa4c59ad5b5581f00', 'service_catalog': [{u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://172.21.7.40:8776/v1/4537aca4a4a4462fa4c59ad5b5581f00', u'region': u'RegionOne', u'publicURL': u'http://172.21.7.40:8776/v1/4537aca4a4a4462fa4c59ad5b5581f00', u'id': u'0a1c8da4f156495aad2130e2c0691982', u'internalURL': u'http://172.21.7.40:8776/v1/4537aca4a4a4462fa4c59ad5b5581f00'}], u'type': u'volume', u'name': u'cinder'}], 'request_id': 'req-c0439276-3600-49cb-8de5-680b3f7d735c', 'instance_lock_checked': False, 'project_id': u'4537aca4a4a4462fa4c59ad5b5581f00', 'user_name': u'admin', 'read_deleted': 'no', 'user': u'91d732b65831491d8bd952b3111e62dd'}
    ======================================================================================
    """

    # Add the exception arguments if asked to do a raise
    extra = {}
    if do_raise:
        extra.update(exc=exception.PolicyNotAuthorized, action=action)

    """
    ======================================================================================
    action = xdrs:get_algorithms
    target = <xdrs.objects.instance.Instance object at 0x62b4a50>
    credentials = {'project_name': u'admin', 'user_id': u'91d732b65831491d8bd952b3111e62dd', 'roles': [u'heat_stack_owner', u'_member_', u'admin'], 'timestamp': '2015-03-10T06:48:40.110653', 'auth_token': 'MIIT9wYJKoZIhvcNAQcCoIIT6DCCE+QCAQExCTAHBgUrDgMCGjCCEk0GCSqGSIb3DQEHAaCCEj4EghI6eyJhY2Nlc3MiOiB7InRva2VuIjogeyJpc3N1ZWRfYXQiOiAiMjAxNS0wMy0xMFQwNjo0ODozOS41MzU2NjEiLCAiZXhwaXJlcyI6ICIyMDE1LTAzLTEwVDA3OjQ4OjM5WiIsICJpZCI6ICJwbGFjZWhvbGRlciIsICJ0ZW5hbnQiOiB7ImRlc2NyaXB0aW9uIjogImFkbWluIHRlbmFudCIsICJlbmFibGVkIjogdHJ1ZSwgImlkIjogIjQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgIm5hbWUiOiAiYWRtaW4ifX0sICJzZXJ2aWNlQ2F0YWxvZyI6IFt7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc0L3YyLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzQvdjIvNDUzN2FjYTRhNGE0NDYyZmE0YzU5YWQ1YjU1ODFmMDAiLCAiaWQiOiAiMTZiMTVjYzVmZjUwNGNiODlmNTg2NjRlMjdhNjljNjkiLCAicHVibGljVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc0L3YyLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogImNvbXB1dGUiLCAibmFtZSI6ICJub3ZhIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjk2OTYvIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjk2OTYvIiwgImlkIjogIjFiMjkzYTgxNjk2YjRiN2Y4OTZlYWQ0NjIyYTFjMmExIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6OTY5Ni8ifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAibmV0d29yayIsICJuYW1lIjogIm5ldXRyb24ifSwgeyJlbmRwb2ludHMiOiBbeyJhZG1pblVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODc3Ni92Mi80NTM3YWNhNGE0YTQ0NjJmYTRjNTlhZDViNTU4MWYwMCIsICJyZWdpb24iOiAiUmVnaW9uT25lIiwgImludGVybmFsVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc2L3YyLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgImlkIjogIjNhNzY3OWNjZTdkZjRhY2ZhMTZiM2NhNTJkZGNmYzgyIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODc3Ni92Mi80NTM3YWNhNGE0YTQ0NjJmYTRjNTlhZDViNTU4MWYwMCJ9XSwgImVuZHBvaW50c19saW5rcyI6IFtdLCAidHlwZSI6ICJ2b2x1bWV2MiIsICJuYW1lIjogImNpbmRlcnYyIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzQvdjMiLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODc3NC92MyIsICJpZCI6ICIwYmIxZDFiODhhZmU0MGRhOTNiY2IxNTg0Y2ExN2ZiOSIsICJwdWJsaWNVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzQvdjMifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAiY29tcHV0ZXYzIiwgIm5hbWUiOiAibm92YXYzIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwODAiLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODA4MCIsICJpZCI6ICIxZTMyZTE3MmU3OWM0YzVhYTZiNWM3ZjhkNzVhZjRmYiIsICJwdWJsaWNVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwODAifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAiczMiLCAibmFtZSI6ICJzd2lmdF9zMyJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo5MjkyIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjkyOTIiLCAiaWQiOiAiM2QxYzc5MjY1MWEwNDljNWE2MWUzNWJmZWZjNGM4OGIiLCAicHVibGljVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo5MjkyIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogImltYWdlIiwgIm5hbWUiOiAiZ2xhbmNlIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzciLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODc3NyIsICJpZCI6ICIzOWE0YzA2NDIzYTg0OTNjOTI4ZGExOGY0YTVjY2MxZiIsICJwdWJsaWNVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzcifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAibWV0ZXJpbmciLCAibmFtZSI6ICJjZWlsb21ldGVyIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwMDAvdjEvIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwMDAvdjEvIiwgImlkIjogIjU1NzBiOGY4MTE0OTRlMWI5NTVkYjZlNTAzZGYyYWZkIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODAwMC92MS8ifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAiY2xvdWRmb3JtYXRpb24iLCAibmFtZSI6ICJoZWF0LWNmbiJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc2L3YxLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzYvdjEvNDUzN2FjYTRhNGE0NDYyZmE0YzU5YWQ1YjU1ODFmMDAiLCAiaWQiOiAiMGExYzhkYTRmMTU2NDk1YWFkMjEzMGUyYzA2OTE5ODIiLCAicHVibGljVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4Nzc2L3YxLzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogInZvbHVtZSIsICJuYW1lIjogImNpbmRlciJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4NzczL3NlcnZpY2VzL0FkbWluIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjg3NzMvc2VydmljZXMvQ2xvdWQiLCAiaWQiOiAiMDMzZjY3ZTk1MDBjNDljYThmOGIxODkzZTJhN2VkYWYiLCAicHVibGljVVJMIjogImh0dHA6Ly8xNzIuMjEuNy40MDo4NzczL3NlcnZpY2VzL0Nsb3VkIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogImVjMiIsICJuYW1lIjogIm5vdmFfZWMyIn0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwMDQvdjEvNDUzN2FjYTRhNGE0NDYyZmE0YzU5YWQ1YjU1ODFmMDAiLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODAwNC92MS80NTM3YWNhNGE0YTQ0NjJmYTRjNTlhZDViNTU4MWYwMCIsICJpZCI6ICI0YmViNjQ0MjUzYWU0NzdmOWU5NDk2ZWVkZDEwOTNhNSIsICJwdWJsaWNVUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjgwMDQvdjEvNDUzN2FjYTRhNGE0NDYyZmE0YzU5YWQ1YjU1ODFmMDAifV0sICJlbmRwb2ludHNfbGlua3MiOiBbXSwgInR5cGUiOiAib3JjaGVzdHJhdGlvbiIsICJuYW1lIjogImhlYXQifSwgeyJlbmRwb2ludHMiOiBbeyJhZG1pblVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODA4MC8iLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODA4MC92MS9BVVRIXzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIiwgImlkIjogIjNhMTA2MzU0MjYxMDQzMjk5YTVkMjQ3ZTVmMjU5NGQyIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6ODA4MC92MS9BVVRIXzQ1MzdhY2E0YTRhNDQ2MmZhNGM1OWFkNWI1NTgxZjAwIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogIm9iamVjdC1zdG9yZSIsICJuYW1lIjogInN3aWZ0In0sIHsiZW5kcG9pbnRzIjogW3siYWRtaW5VUkwiOiAiaHR0cDovLzE3Mi4yMS43LjQwOjM1MzU3L3YyLjAiLCAicmVnaW9uIjogIlJlZ2lvbk9uZSIsICJpbnRlcm5hbFVSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6NTAwMC92Mi4wIiwgImlkIjogIjVjNGVlN2MzMTE4NDQyNGM5NDJhMWM1MjgxODU3MmZiIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTcyLjIxLjcuNDA6NTAwMC92Mi4wIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogImlkZW50aXR5IiwgIm5hbWUiOiAia2V5c3RvbmUifV0sICJ1c2VyIjogeyJ1c2VybmFtZSI6ICJhZG1pbiIsICJyb2xlc19saW5rcyI6IFtdLCAiaWQiOiAiOTFkNzMyYjY1ODMxNDkxZDhiZDk1MmIzMTExZTYyZGQiLCAicm9sZXMiOiBbeyJuYW1lIjogImhlYXRfc3RhY2tfb3duZXIifSwgeyJuYW1lIjogIl9tZW1iZXJfIn0sIHsibmFtZSI6ICJhZG1pbiJ9XSwgIm5hbWUiOiAiYWRtaW4ifSwgIm1ldGFkYXRhIjogeyJpc19hZG1pbiI6IDAsICJyb2xlcyI6IFsiZDlmZGVlODI1NjE3NGJlNWE3MmFjZGZmNDNkM2VkZDMiLCAiOWZlMmZmOWVlNDM4NGIxODk0YTkwODc4ZDNlOTJiYWIiLCAiN2E1ZTg5MmFiYTE5NDI3NWI3ZjQxZWM4Njg2ZDUwOGYiXX19fTGCAYEwggF9AgEBMFwwVzELMAkGA1UEBhMCVVMxDjAMBgNVBAgMBVVuc2V0MQ4wDAYDVQQHDAVVbnNldDEOMAwGA1UECgwFVW5zZXQxGDAWBgNVBAMMD3d3dy5leGFtcGxlLmNvbQIBATAHBgUrDgMCGjANBgkqhkiG9w0BAQEFAASCAQBkwVlwVgYM+mCIXICViGPgW+AZ--Y3NfWjW92GTBqW4keVrPosYxz--b2SVSGqwOHI1xFPqIx1+fzBCcilE5rIuJ3gxAc2VEWl4whMkriqWo6M8YY+GxGJ07h1NZ3Jc9Mrk7RTWPwU9YPilWPSU9sRx4bv+y7XpL8EIEvi+0dvHKgGI+nvqEYVFIf1vYQN5bvSnAgC1rZ9oB0M4Pg1wd47xQcenZL+XOWb8uxUReAvT-lfjXav7DhwUzPgmlY2XpN+9yfhAXAFF0GkokwjncvC5YTILOa41eMUg8ip47+rijNpQ2FuxVpRhQ-xL9it8+vAYkGLqe7eaQylsf0Nu6JJ', 'remote_address': '172.21.7.40', 'quota_class': None, 'is_admin': True, 'tenant': u'4537aca4a4a4462fa4c59ad5b5581f00', 'service_catalog': [{u'endpoints_links': [], u'endpoints': [{u'adminURL': u'http://172.21.7.40:8776/v1/4537aca4a4a4462fa4c59ad5b5581f00', u'region': u'RegionOne', u'publicURL': u'http://172.21.7.40:8776/v1/4537aca4a4a4462fa4c59ad5b5581f00', u'id': u'0a1c8da4f156495aad2130e2c0691982', u'internalURL': u'http://172.21.7.40:8776/v1/4537aca4a4a4462fa4c59ad5b5581f00'}], u'type': u'volume', u'name': u'cinder'}], 'request_id': 'req-c0439276-3600-49cb-8de5-680b3f7d735c', 'instance_lock_checked': False, 'project_id': u'4537aca4a4a4462fa4c59ad5b5581f00', 'user_name': u'admin', 'read_deleted': 'no', 'user': u'91d732b65831491d8bd952b3111e62dd'}
    extra = {'action': 'xdrs:get_algorithms', 'exc': <class 'xdrs.exception.PolicyNotAuthorized'>}
    ======================================================================================
    """
    return policy.check(action, target, credentials, **extra)


def check_is_admin(context):
    """
    Whether or not roles contains 'admin' role according to policy setting.
    """
    init()

    #the target is user-self
    credentials = context.to_dict()
    target = credentials

    return policy.check('context_is_admin', target, credentials)


@policy.register('is_admin')
class IsAdminCheck(policy.Check):
    """An explicit check for is_admin."""

    def __init__(self, kind, match):
        """Initialize the check."""

        self.expected = (match.lower() == 'true')

        super(IsAdminCheck, self).__init__(kind, str(self.expected))

    def __call__(self, target, creds):
        """Determine whether is_admin matches the requested value."""

        return creds['is_admin'] == self.expected


def get_rules():
    return policy._rules
